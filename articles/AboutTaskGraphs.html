<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>About task graphs • tiledbcloud</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="About task graphs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tiledbcloud</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/TileDB-Inc/TileDB-Cloud-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="AboutTaskGraphs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>About task graphs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TileDB-Inc/TileDB-Cloud-R/blob/main/vignettes/AboutTaskGraphs.Rmd" class="external-link"><code>vignettes/AboutTaskGraphs.Rmd</code></a></small>
      <div class="d-none name"><code>AboutTaskGraphs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="parallelism">Parallelism<a class="anchor" aria-label="anchor" href="#parallelism"></a>
</h2>
<ul>
<li><p>The <code>future</code> package’s default behavior is zero parallelism – hence we need an explicit <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan</a></code>.</p></li>
<li><p>Future’s <code>plan::multicore</code> is more or less like Python’s <code>ProcessPoolExecutor</code>. There exists no analog of <code>ThreadPoolExecutor</code> for R, and our understanding is there never will be – too many issues with threads and R.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="processes">Processes<a class="anchor" aria-label="anchor" href="#processes"></a>
</h2>
<ul>
<li><p>Say you have a 2-node DAG where node B depends on node A.</p></li>
<li><p>There is an R process for the call to <code>compute(B)</code>. Inside that is <code>dag$poll()</code> which invokes <code>node$poll()</code> for both the A and B nodes.</p></li>
<li><p>There will be a forked R process (mananged by the <code>future</code> package) for the call to A’s future, and another forked R process for the call to B’s future.</p></li>
<li><p>Both of those forked R processes, in turn, are just sitting in a synchronous call to the REST server to execute the UDF/SQL/etc. So, in any non-trivial DAG, the parent/polling process spends most of its time awaiting futures which are running in the child/forked processes, and those are in turn spending most of their time awaiting the results of HTTP requests to the REST server.</p></li>
<li><p>Those futures resolve into the parent process’ called to <code>resolved()</code>. The <em>only</em> communication between child processes and the parent process is via (a) the return value from the future, and stdout prints by the child. Crucially, prints to stderr are completely lost, and prints to stdout do <em>not</em> go directly to stdout – they only are obtainable once the future is <em>resolved</em> and the parent process gets all the child process’ stdout lines all at one go via <code>self$future_result$stdout)</code>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="call-flow">Call flow<a class="anchor" aria-label="anchor" href="#call-flow"></a>
</h2>
<ul>
<li>Nodes are defined by calls to the delayed factory function, with edges via their args. Note that the DAG is at this point implicit in these nodes and edges.</li>
</ul>
<pre><code>    a &lt;- delayed(function()  {   9  },                 name='a')
    b &lt;- delayed(function(x) { 10*x }, args=list(a),   name='b')
    o &lt;- compute(a), namespace='namespace_to_charge')</code></pre>
<ul>
<li><p>The terminal node’s <code><a href="../reference/compute.html">compute()</a></code> function instantiates a DAG object and stashes it as a slot within that node, for easy reference later. Nodes and edges are already in existence; the DAG’s purpose is to check for cycles, identify initial nodes, etc.</p></li>
<li><p>The DAG is poll-driven: its <code>poll()</code> method calls every node’s <code>poll()</code> method until computation is complete, or has failed at a node. In the latter case there is a <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> which aborts the DAG poll and returns control to the user.</p></li>
<li><p>Calling <code><a href="../reference/compute.html">compute()</a></code> again on the terminal node will leave computed nodes computed, and running nodes running, but will retry the failed nodes.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<ul>
<li><p>If you are doing light debug, just have R do <code>print</code>/<code>cat</code>/etc within the node functions – their stdout will appear once the future completes.</p></li>
<li><p>If you are doing hard debug, and if you need info on child processes which are still running – I’ve used R’s <code>broswer</code> to debug the parent process, but I don’t know how to make that to work to debug child processes. The best experience I can suggest is doing write-to-disk-file within the child process and then tail that disk file from a separate terminal.</p></li>
<li>
<p>DAG invocation: More detail in the user-level vignette, but the essentials are:</p>
<ul>
<li><code>a &lt;- delayed(function()  {   9  },                 name='a')</code></li>
<li><code>b &lt;- delayed(function(x) { 10*x }, args=list(a),   name='b')</code></li>
<li>Simplest:
<ul>
<li><code>o &lt;- compute(a), namespace='namespace_to_charge')</code></li>
<li><code>show(o$dag_for_terminal)</code></li>
<li><code>str(o$dag_for_terminal)</code></li>
<li><code>o &lt;- compute(a), namespace='namespace_to_charge') # retry failed nodes</code></li>
</ul>
</li>
<li>More detail:
<ul>
<li><code>o &lt;- compute(a), namespace='namespace_to_charge', verbose=TRUE)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by TileDB, Inc., John Kerl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
